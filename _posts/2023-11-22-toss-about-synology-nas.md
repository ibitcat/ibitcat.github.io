---
title:  "ç¾¤æ™–NASæŠ˜è…¾è®°"
date: 2023-11-22
tag:
- NAS
---

æ­å»ºå®¶åº­ NAS æˆ‘ä»å¾ˆä¹…ä¹‹å‰å°±æœ‰è¿™ä¸ªæƒ³æ³•äº†ï¼ŒæœŸé—´ä¹Ÿä¼šä¸é—´æ–­å»äº†è§£ NAS ç›¸å…³çŸ¥è¯†ï¼Œæ°é€¢åŒ 11 å†åŠ ä¸Šè‡ªå·±çš„ iphone å­˜å‚¨å·²ç»åˆ°é¡¶ï¼ˆ*ä¹Ÿè®©æˆ‘è·å¾—ä¸€ä¸ªæ•™è®­ï¼Œå¯¹äºé•¿æ—¶é—´ä½¿ç”¨çš„ç”µå­äº§å“åƒä¸‡ä¸è¦ä¹°ä¸ç‰ˆ*ï¼‰ï¼Œä¾¿åœ¨æŸä¸€å¤©å†²åŠ¨å‰æ‰‹ï¼Œè´­å…¥äº†ç¾¤æ™– NAS `ds224+`ï¼Œä¸Šå‘¨åˆ°è´§åï¼Œä¾¿è¿«ä¸åŠå¾…å¼€å§‹æŠ˜è…¾èµ·æ¥ï¼ŒæœŸé—´ä¹Ÿè¸©è¿‡äº†ä¸å°‘å‘ï¼Œæœ¬æ–‡å°†è®°å½•ä¸€ä¸ª NAS æ–°æ‰‹çš„æŠ˜è…¾ä¹‹æ—…ã€‚

## ç›˜ä½ä¸RAID
åœ¨é€‰æ‹© NAS å‹å·æ—¶ï¼Œçº ç»“äº†å¾ˆä¹… 2 ç›˜ä½å’Œ 4 ç›˜ä½ï¼Œæœ€ç»ˆæ•´ç†äº†è‡ªå·±çš„éœ€æ±‚å¦‚ä¸‹ï¼š
- å®¶åº­ç…§ç‰‡å­˜å‚¨ï¼Œç”¨äºå–ä»£ `icloud photos`ï¼ˆicloud fow windows åŒæ­¥ç…§ç‰‡å®åœ¨æ—¶æ‹‰è·¨ï¼‰
- æ„å»ºç®€å•çš„å®¶åº­å½±éŸ³ï¼Œä½†æ˜¯éœ€æ±‚ä¸å¤§
- å­˜å‚¨å¤‡ä»½èµ„æ–™ï¼ŒåŒ…æ‹¬é‡è¦æ–‡æ¡£ï¼Œé¡¹ç›®ä»£ç ï¼Œä¹¦ç±pdfç­‰
- è§£æ”¾ç”µè„‘çš„å­˜å‚¨å‹åŠ›ï¼Œå®¶é‡Œçš„å°å¼æœºå’Œç¬”è®°æœ¬ç¡¬ç›˜éƒ½æ¯”è¾ƒå°ï¼Œæ—¥ç§¯æœˆç´¯éƒ½å·²ç»å˜çº¢äº†
- å¯èƒ½å°è¯•ä¸€äº›é«˜çº§ç©æ³•ï¼Œå¦‚æ­å»º git æœåŠ¡å™¨

ç»“åˆä»¥ä¸Šçš„éœ€æ±‚ï¼Œæˆ‘è§‰å¾— 2 ç›˜ä½å·²ç»æ»¡è¶³äº†ï¼ˆå…¶å®æ˜¯è·åŒ…ä¸å¤Ÿé¥±æ»¡ï¼‰ï¼Œé…ä¸Šä¸¤å¼  8T + 12 T çš„ NAS ç›˜ï¼Œå†…å­˜åŠ åˆ° 6Gï¼Œåº”è¯¥å·²ç»æ»¡è¶³ã€‚
å…³äºç¡¬ç›˜ï¼Œå…¶ä¸­ 8T æ˜¯ä¸»ç¡¬ç›˜ï¼Œä¸ºäº†ä¿è¯ç¨³å®šæ€§ï¼Œæ‰€ä»¥åœ¨ JD è´­å…¥ï¼Œå¦å¤–ä¸€å¼  12T æ‰“ç®—ä½œä¸ºéé‡è¦æ•°æ®å­˜å‚¨ä»¥åŠåŒç›˜å¤‡ä»½ï¼Œåœ¨å°çº¢ä¹¦ä¸Šè´­å…¥ï¼Œä¸”æˆ‘å¹¶æ²¡æœ‰ raidï¼Œç½‘ä¸Šå…³äº raid ä¼—è¯´çº·çº­ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºç”¨ raid æ¥åšæ•°æ®å¤‡ä»½æœ‰ç‚¹æ‰¯æ·¡ï¼Œå…³äºæ•°æ®çš„å¤‡ä»½ï¼Œæˆ‘è¿˜æ˜¯éµä»â€œå¤šä»‹è´¨å¤šåœ°ç‚¹â€çš„åŸåˆ™ï¼Œæˆ‘çš„å¤‡ä»½ç­–ç•¥å¦‚ä¸‹ï¼š
- é‡è¦æ•°æ®ä½†æ•°æ®æœªè¿‡Tï¼ˆå¦‚ç…§ç‰‡ã€é‡è¦æ–‡æ¡£ç­‰ï¼‰ï¼ŒNAS å†…éƒ¨åŒç›˜å¤‡ä»½ x ç§»åŠ¨ç¡¬ç›˜å†·å¤‡ x äº‘ç›˜å¤‡ä»½ï¼Œèƒ½ä¿è¯ NAS å†…éƒ¨æœ‰å¤‡ä»½ï¼Œå®¶åº­å…¶ä»–ä»‹è´¨ä¸Šæœ‰å¤‡ä»½ï¼Œä»¥åŠäº‘ç«¯ä¹Ÿæœ‰å¤‡ä»½ï¼Œæœ‰æ¡ä»¶å¯ä»¥åšå¤šä¸ªå¤‡ä»½
- é‡è¦æ•°æ®ä½†æ•°æ®è¿‡å¤§(å¦‚è´­ä¹°/ä¸‹è½½çš„è§†é¢‘æ•™ç¨‹ã€ç¾æœ¯èµ„æºç­‰)ï¼Œè§†æ•°æ®å¤§å° NAS å†…éƒ¨åŒç›˜å¤‡ä»½ x ç§»åŠ¨ç¡¬ç›˜å†·å¤‡(å¤šä»½)
- æ™®é€šæ•°æ®ï¼Œéœ€è¦è‡ªå·±æ ¹æ®æƒ…å†µï¼ˆå¦‚å¯é‡æ–°è·å–éš¾åº¦ã€æ•°æ®å¤§å°ï¼‰æ¥å†·å¤‡

æ€»ç»“æ¥è¯´ï¼š**çœŸæ­£é‡è¦çš„æ•°æ®å…¶å®å¹¶ä¸ä¼šå¾ˆå¤§ï¼Œè¿™äº›æ•°æ®å°±è¦è°¨æ…ä¹‹é‡è§†ä¹‹ï¼Œå…¶ä»–æ•°æ®è§†æƒ…å†µè€Œå®š**ã€‚
æ­¤å¤–ï¼Œè¦åœ¨ç¡¬ç›˜ä½¿ç”¨åˆ°æœŸå‰ç”¨æ–°ç›˜æ›¿æ¢ï¼Œä¸€èˆ¬å‘¨æœŸ 5 ~ 6 å¹´ï¼Œå°½é‡ä¿è¯ç¡¬ç›˜éƒ½åœ¨â€œæœ‰æ•ˆæœŸâ€å†…ã€‚

## DSM é…ç½®
DSM ç³»ç»Ÿè¿˜æ˜¯è¾ƒä¸ºç®€å•å‚»ç“œï¼Œç›®å‰æˆ‘çš„DSMç‰ˆæœ¬æ˜¯ 7.2ï¼Œåˆå§‹åŒ–å®Œ NASï¼Œå¹¶æ²¡æœ‰å¤ªå¤šä¸œè¥¿éœ€è¦ä¿®æ”¹ï¼Œä¸‹é¢åˆ—å‡ºäº†æˆ‘ä¿®æ”¹çš„éƒ¨åˆ†ï¼š
- ä¿®æ”¹äº†ç™»å½•é—¨æˆ·çš„ http ç«¯å£ï¼Œé»˜è®¤æ˜¯ 5000 å’Œ 5001ï¼ŒæŒ‰ç¾¤æ™–çš„ç”¨æˆ·é‡ï¼Œåº”è¯¥ç®—æ˜¯æ¯”è¾ƒå‘¨çŸ¥çš„ç«¯å£äº†ï¼Œåˆè¢«äººæ‰«æçš„é£é™©ï¼Œæ‰€ä»¥æˆ‘æ”¹æ‰äº†;
- ç½‘ç»œéƒ¨åˆ†ï¼Œæ‰‹åŠ¨é…ç½®äº† DNS æœåŠ¡å™¨ï¼Œå›½å†…é¦–é€‰ï¼š`114.114.114.144`æˆ–`223.5.5.5`ï¼Œè¿™é‡Œä¸»è¦æ˜¯è§£å†³ quickconnect çš„è¿æ¥é—®é¢˜ï¼›
- è®¾ç½®äº†ä»£ç†æœåŠ¡å™¨ï¼Œåœ°å€ï¼š`localhost`ï¼Œç«¯å£ï¼š`8118`ï¼Œé€šè¿‡ `clash+privoxy` æ–¹æ¡ˆå¼€å¯è‡ªåŠ¨ä»£ç†;

## å¥—ä»¶

DSM æœ‰ä¸€ä¸ªâ€œå¥—ä»¶ä¸­å¿ƒâ€ï¼Œå…¶å®å°±æ˜¯ç±»ä¼¼æ‰‹æœºçš„ â€œåº”ç”¨ä¸­å¿ƒâ€ï¼Œå¯ä»¥ä¸‹è½½å®‰è£…å®˜æ–¹çš„å¥—ä»¶ï¼Œä¹Ÿå¯ä»¥æ·»åŠ ç¬¬ä¸‰æ–¹å¥—è£…æºï¼Œä»è€Œå®‰è£…ç¬¬ä¸‰æ–¹çš„å¥—ä»¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰‹åŠ¨å®‰è£…ç¬¬ä¸‰æ–¹å¥—ä»¶ï¼Œå¥—ä»¶çš„åç¼€åä¸º `.spk`ã€‚å½“ç„¶ï¼Œè¿™éƒ¨åˆ†å†…å®¹åº”è¯¥ä¼šæŒç»­æŠ˜è…¾ã€‚

### å®˜æ–¹å¥—ä»¶
ç›®å‰æˆ‘å®‰è£…çš„å‡ ä¸ªå®˜æ–¹å¥—ä»¶å¦‚ä¸‹ï¼š
- `Cloud Sync`ï¼Œè¿™ä¸ªå¥—ä»¶ä¸»è¦æ˜¯ç”¨æ¥åŒæ­¥ç…§ç‰‡åˆ°ç™¾åº¦äº‘ï¼Œå¦‚æœè®¾ç½®äº†å¯†ç ï¼ŒåŒæ­¥çš„åˆ°äº‘ç›˜çš„æ–‡ä»¶å°†è¢«åŠ å¯†ï¼Œè¿™æ ·åˆ«äººä¸‹è½½åçœ‹åˆ°çš„å†…å®¹éƒ½æ˜¯ä¹±ç ï¼Œå¯ä»¥é€šè¿‡ç¾¤æ™–æä¾›çš„è½¯ä»¶ `Synology Cloud Sync Decryption Tool` æ¥è§£å¯†æ–‡ä»¶ã€‚

- `Synology Drive`ï¼Œé…å¥—çš„ `Synology Drive Server` ä¹Ÿè¦ä¸€èµ·å®‰è£…ï¼ŒåŠŸèƒ½ç±»ä¼¼å¾®è½¯çš„ OneDriveï¼Œå®ƒæä¾›ä¸¤ç§æ¨¡å¼ï¼šåŒæ­¥æ¨¡å¼å’Œå¤‡ä»½æ¨¡å¼ã€‚ä¸åŒçš„ç³»ç»Ÿéƒ½æœ‰å¯¹äºçš„Drive Clientï¼Œ~~ä¸è¿‡åœ¨ä½¿ç”¨ä¸­ï¼Œapp ç‰ˆæœ¬åœ¨ 4G ç½‘ç»œæ— æ³•ä½¿ç”¨quickconnect Idè¿æ¥ driveï¼Œä½†æ˜¯åœ¨ WIFI ä¸‹å¯ä»¥è¿(å…¬å¸çš„wifiä¸‹ä¹Ÿå¯ä»¥)ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ã€‚ç›®å‰åœ¨4Gç½‘ç»œä¸‹çš„è§£å†³åŠæ³•åªèƒ½æ˜¯é…åˆå†…ç½‘ç©¿é€æ¥è¿æ¥drive~~ã€‚

    **ã€å·²è§£å†³ã€‘**ï¼šé€šè¿‡å’Œç¾¤æ™–å®˜æ–¹çš„æŠ€æœ¯äººå‘˜å’¨è¯¢ï¼Œå‘ç° drive appä¸Šçš„ç™»å½•è¯·æ±‚éƒ½å‘ç”Ÿåˆ°äº†å…¨çƒç«™ï¼Œè€Œä¸æ˜¯ä¸­å›½ç«™ï¼ŒåŸæ¥æ˜¯æˆ‘çš„ iphone åœ°åŒºè®¾ç½®æˆç¾å›½(åº”è¯¥æ˜¯ä¹‹å‰ç™»å½•ç¾åŒºè´¦å·åæ²¡æœ‰åˆ‡æ¢å›æ¥)ï¼Œå…·ä½“æ“ä½œï¼šè¿›å…¥ `è®¾ç½® â¡ï¸ é€šç”¨ â¡ï¸ åœ°åŒºä¸è¯­è¨€`ï¼Œä¿®æ”¹åœ°åŒºæˆ **ã€ä¸­å›½ã€‘**ã€‚

- `Video Stasion`ï¼Œå®˜æ–¹çš„å½±éŸ³å¥—ä»¶ï¼Œé…å¥—çš„ `Advanced Media Extensions` ä¹Ÿè¦ä¸€èµ·å®‰è£…ï¼ˆè¿˜éœ€è¦ä¸€ä¸ªffmpegï¼Œåé¢ä¼šè¯´ï¼‰ï¼Œç”µå½±æµ·æŠ¥ä¿¡æ¯çš„åˆ®å‰Šä½¿ç”¨äº† TMDB çš„apiï¼Œæ ¹æ®å®˜æ–¹çš„æŒ‡å¼•æ³¨å†Œå¯ä»¥è·å¾— api çš„keyï¼Œä¸è¿‡å› ä¸ºå›½å†…å¢™çš„å…³ç³»ï¼Œapiåœ°å€`api.themoviedb.org`å·²ç»è¢«blockï¼Œéœ€è¦ä½¿ç”¨ä¸€äº›æ‰‹æ®µæ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œåé¢ä¼šè¯´ã€‚

### ç¤¾åŒºå¥—ä»¶

è¿™é‡Œåˆ—å‡ºäº†æˆ‘æ·»åŠ çš„å‡ ä¸ªç¤¾åŒºå¥—ä»¶æºï¼š
- æˆ‘ä¸æ˜¯çŸ¿ç¥ï¼Œåœ°å€ï¼š`https://spk7.imnks.com/`
- synocommunityï¼Œåœ°å€ï¼š`https://packages.synocommunity.com/`

æˆ‘ä¸æ˜¯çŸ¿ç¥ï¼Œæˆ‘ä¸»è¦æ˜¯ç”¨æ¥å®‰è£…é‡Œé¢çš„ frpï¼Œè§£å†³ä¸Šé¢æåˆ°çš„ 4G ç½‘ç»œè®¿é—® drive çš„é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä½¿ç”¨çš„æ˜¯ [æ¨±èŠ±frp](https://www.natfrp.com/)ï¼Œæ‰€ä»¥ä¸‹è½½å®‰è£… `SakuraFrp`ï¼Œæ‰“å¼€åé…ç½®ä¹Ÿå¾ˆç®€å•ï¼Œå¤§æ¦‚æ ¼å¼å¦‚ä¸‹ï¼š
```bash
token=xxxx      #è¿™é‡Œå¡«è´¦å·çš„å¯†é’¥
idx=123,456     #è¿™é‡Œå¡«éš§é“idï¼Œå¦‚æœæœ‰å¤šä¸ªéš§é“ç”¨è‹±æ–‡é€—å·éš”å¼€
```
![sakuraFrp](/assets/image/posts/2023-11-22-01.png?style=centerme)

synocommunityï¼Œè¿™ä¸ªæºé‡Œé¢ä¸»è¦å®‰è£… `ffmpeg 6`ï¼Œå®‰è£…å®Œåï¼Œä½¿ç”¨ ssh ç™»å½•åˆ°nasç³»ç»Ÿï¼Œå¹¶ä½¿ç”¨ `sudo -i` è¾“å…¥å¯†ç ååˆ‡æ¢åˆ° root ç”¨æˆ·ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:
```bash
bash -c "$(curl "https://raw.githubusercontent.com/darknebular/Wrapper_VideoStation/main/installer.sh")" -- -s install
```
ç­‰å¾…å®‰è£…å®Œæ¯•ã€‚æ›´é«˜é˜¶çš„å®‰è£…å‚è€ƒ[Wrapper_VideoStation](https://github.com/darknebular/Wrapper_VideoStation)çš„æ–‡æ¡£ã€‚

**æ³¨æ„ï¼š** å®‰è£…å®Œ AME å¥—ä»¶åè¦æ¿€æ´»ä¸€æ¬¡(å³ä½¿ç”¨Video stationæ’­æ”¾ä¸€æ¬¡)å†å®‰è£…ï¼Œå¦åˆ™ä¼šæŠ¥ä»¥ä¸‹é”™è¯¯ï¼š
```bash
ERROR: YOU HAVEN'T THE LICENCE LOADED in Advanced Media Extension package. Please, LOAD this licence and try again with the Installer.
```
å‚è€ƒè¿™ä¸ª[issue](https://github.com/darknebular/Wrapper_VideoStation/issues/36)ã€‚

## ç§‘å­¦ä¸Šç½‘
ä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå›½å†…ä¸Šç½‘éœ€è¦ä¸€äº›ç§‘æŠ€ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ clash + privoxy çš„ç»„åˆæ¥å®ç°ç§‘å­¦ä¸Šç½‘ã€‚
- clashï¼ŒåŸä½œè€…å·²ç»åˆ åº“è·‘è·¯äº†ï¼Œä¸è¿‡æ‰¾åˆ°äº†ä¸€ä¸ªå¤‡ä»½ä»“åº“[Clash-premium](https://github.com/zhongfly/Clash-premium-backup)
- privoxyï¼Œgithubæœ‰å¥—ä»¶ç‰ˆæœ¬[privoxy-dsm](https://github.com/davidcava/privoxy-dsm)ï¼Œä¸‹è½½å¥—ä»¶æ‰‹åŠ¨å®‰è£…å³å¯

### clash
clash å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š
- ä¸‹è½½å¹¶è§£å‹ clash äºŒè¿›åˆ¶åŒ…ï¼Œæ ¹æ®cpuå¹³å°é€‰æ‹©æ­£ç¡®çš„å‹ç¼©åŒ…ï¼Œæˆ‘é€‰æ‹© clash-linux-amd64-n2023-09-05-gdcc8d87.gz
- ä¸‹è½½è‡ªå·±çš„æœºåœºçš„ config.yaml é…ç½®æ–‡ä»¶
- ä¸‹è½½ [yacd dashboard](https://github.com/haishanh/yacd)
- ä¿®æ”¹config.yamlé…ç½®ï¼ŒæŒ‡å®š dashboard

å‘½ä»¤å¦‚ä¸‹ï¼š
```bash
mkdir -p /root/.config/clash
cd /root/.config/clash
wget "ä½ çš„è®¢é˜…é“¾æ¥" -O config.yaml
wget https://github.com/zhongfly/Clash-premium-backup/releases/download/2023-09-05-gdcc8d87/clash-linux-amd64-n2023-09-05-gdcc8d87.gz
wget https://github.com/haishanh/yacd/releases/download/v0.3.8/yacd.tar.xz
gzip -d clash-linux-amd64-n2023-09-05-gdcc8d87.gz
tar -xvf yacd.tar.xz
mv clash-linux-amd64 clash
chmod +x clash
mv public dashboard
```

ç¼–è¾‘ config.yaml é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ  dashboard ui:
```yaml
external-ui: dashboard // å¢åŠ è¿™ä¸€è¡Œ
external-controller: 0.0.0.0:9090
```

è¾“å…¥ `./clash -d .` è¿è¡Œ clashï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `http://ä½ nasçš„ip:9090/ui` å³å¯è¿›å…¥ clash ç½‘é¡µç®¡ç†ç•Œé¢ã€‚

æ¯æ¬¡æ‰‹åŠ¨è¿è¡Œclashä¹ŸæŒºéº»çƒ¦ï¼Œæˆ‘ä»¬ç”¨æœåŠ¡çš„æ–¹å¼å¯åŠ¨ clashï¼Œå¹¶åŠ å…¥åˆ°å¼€æœºå¯åŠ¨ã€‚å…ˆç§»åŠ¨ clashï¼Œ
```bash
mv clash /usr/local/bin
```

ç„¶ååˆ›å»º clash.service æ–‡ä»¶ï¼š
```bash
vim /usr/local/lib/systemd/system/clash.service
```

è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š
```ini
[Unit]
Description=clash service
After=network.target

[Service]
Type=simple
User=root
ExecStart=/usr/local/bin/clash
# or always, on-abort, etc
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

æœ€åè¿è¡Œ systemctl å‘½ä»¤åŠ è½½æœåŠ¡å¹¶å¯åŠ¨ clash æœåŠ¡ï¼š
```bash
systemctl daemon-reload
systemctl enable clash
systemctl start clash
```

å¯ä»¥ä½¿ç”¨ `sudo journalctl -fu clash` æ¥æŸ¥çœ‹æ—¥å¿—ï¼Œå‰ææ˜¯ systemd-journald æœåŠ¡è¦å…ˆè¿è¡Œï¼Œç”¨ `sudo systemctl status systemd-journald` æ¥æŸ¥çœ‹å¼€å¯çŠ¶æ€ã€‚

åˆ°è¿™é‡Œï¼Œå…¶å®å°±å¯ä»¥ä½¿ç”¨ clash æ¥ç§‘å­¦ä¸Šç½‘äº†ï¼Œå¯ä»¥åœ¨ç”¨æˆ·ç›®å½•çš„ `.bashrc` æ–‡ä»¶ä¸­(æ²¡æœ‰åˆ™åˆ›å»º)æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š
```bash
# Open proxy
clashOn() {
    export https_proxy=http://127.0.0.1:7890
    export http_proxy=http://127.0.0.1:7890
    export all_proxy=socks5://127.0.0.1:7890
    echo "HTTP/HTTPS Proxy on"
}

# Close proxy
clashOff() {
    unset http_proxy
    unset https_proxy
    unset all_proxy
    echo "HTTP/HTTPS Proxy off"
}
```
ä¿å­˜åï¼Œè¿è¡Œ`source ~/.bashrc` ä½¿è„šæœ¬ç”Ÿæ•ˆï¼Œè‹¥æƒ³è¦å¼€å¯ clash å…¨å±€ä»£ç†ï¼Œåˆ™è¾“å…¥ `clashOn`ï¼Œåä¹‹åˆ™è¾“å…¥`clashOff`ã€‚

### privoxy
æ‰‹åŠ¨å¼€å…³ clash å…¨å±€ä»£ç†è¿˜æ˜¯ç•¥æ˜¾éº»çƒ¦ï¼Œè‹¥èƒ½å®ç° windows ç³»ç»Ÿçš„æŒ‰è§„åˆ™è‡ªåŠ¨ä»£ç†å°±å®Œç¾äº†ï¼Œprivoxy æ­£å¥½èƒ½å¸®åŠ©è§£å†³è¿™ä¸ªç—›ç‚¹ã€‚

å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š
- ä¸‹è½½[privoxy-dsmå¥—ä»¶](https://github.com/davidcava/privoxy-dsm/releases/download/3.0.33-1/privoxy-x86_64-3.0.33-1.spk)ï¼Œå¹¶æ‰‹åŠ¨å®‰è£…
- ssh ç™»å½•åˆ° nas ç³»ç»Ÿï¼Œè¿è¡Œ`sudo /var/packages/privoxy/scripts/addprivileges`
- å›åˆ° nas ç³»ç»Ÿç•Œé¢ï¼Œç‚¹å‡»å›¾æ ‡æ‰“å¼€ Privoxy ç®¡ç†é¡µé¢
![privoxy](/assets/image/posts/2023-11-22-02.png?style=centerme)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦ä¿®æ”¹é…ç½®ï¼Œå†æ¬¡ä½¿ç”¨ ssh ç™»å½•åˆ°ç³»ç»Ÿï¼Œå¹¶åˆ‡æ¢æˆ root ç”¨æˆ·ï¼Œè¿›å…¥ Privoxy å¥—ä»¶ç›®å½•ï¼š
```bash
cd /var/packages/privoxy/
```

æš‚æ—¶åªå…³æ³¨ä¸‹é¢ä¸¤ä¸ªç›®å½•ï¼š
- etc ä¸ºé…ç½®ç›®å½•ï¼ŒåŒ…æ‹¬ `config`é…ç½®æ–‡ä»¶ï¼Œ`*.action` ä»£ç†è§„åˆ™æ–‡ä»¶ï¼Œ`*.filter`è¿‡æ»¤è§„åˆ™æ–‡ä»¶
- var æ˜¯è¿è¡Œæ—¶ç›®å½•ï¼Œé‡Œé¢æœ‰pidæ–‡ä»¶å’Œlogæ–‡ä»¶

ä¿®æ”¹ `etc/config`:
```bash
# æ³¨é‡Šæ‰ä¸‹é¢ä¸‰ä¸ªè‡ªå¸¦çš„ action è§„åˆ™æ–‡ä»¶
#actionsfile match-all.action # Actions that are applied to all sites and maybe overruled later on.
#actionsfile default.action   # Main actions file
#actionsfile user.action      # User customizations

# æ·»åŠ è‡ªå·±çš„ action æ–‡ä»¶
actionsfile my.action

# æ³¨é‡Šæ‰è¿‡æ»¤è§„åˆ™æ–‡ä»¶ï¼Œæˆ‘ä»¬åªä½¿ç”¨ä»£ç†åŠŸèƒ½ï¼Œè¿‡æ»¤åŠŸèƒ½æš‚æ—¶ä¸ç”¨(å¯æ‹¦æˆªå¹¿å‘Š)
#filterfile default.filter
#filterfile user.filter      # User customizations

# å¼€å¯ debug 1 å’Œ 65535 (è‡ªå·±å†³å®š,æˆ‘æ˜¯ç”¨æ¥æ£€æµ‹è‡ªåŠ¨ä»£ç†æ˜¯å¦æˆåŠŸ)
debug 1
debug 65535

# ç›‘å¬åœ°å€è¿™é‡Œæˆ‘è®¾ç½®åŒæ—¶ç›‘å¬ ipv4 å’Œ ipv6æœ¬åœ°åœ°å€
# 8118 ç«¯å£ä¸è¦æ”¹ï¼Œå¦åˆ™webç®¡ç†é¡µé¢ä¼šæ‰“ä¸å¼€
listen-address [::]:8118
```

æ¥ä¸‹æ¥ï¼Œæ·»åŠ è‡ªå·±çš„ä»£ç†è§„åˆ™æ–‡ä»¶`vim etc/my.action`ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š
```bash
# é»˜è®¤ä¸èµ°ä»£ç†ï¼Œå…¶ä»–èµ°socks5ä»£ç†
{{alias}}
direct = +forward-override{forward .}
socks5 = +forward-override{forward-socks5 localhost:7891 .}

#default
{direct}
/

#socks5ä»£ç†
{socks5}
.synocommunity.com
.themoviedb.org
.youtube.com
.google.
.google.com
.docker.com
.docker.io
.github.com
```
ä¿å­˜åè¦ä¿®æ”¹æ–‡ä»¶çš„æ‹¥æœ‰è€…ï¼š
```bash
chown privoxy:privoxy etc/my.action
```
æœ€åï¼Œé‡å¯å¥—ä»¶ç”Ÿæ•ˆã€‚æµ‹è¯•ä¸‹æ˜¯å¦èƒ½å¤ŸæˆåŠŸä»£ç†ï¼š
```bash
curl -x 'http://127.0.0.1:8118' www.google.com
```

> è¿™é‡Œéœ€è¦æ³¨æ„çš„ï¼Œä¸Šé¢çš„ç«¯å£ 7891ï¼Œè¦å’Œ clash çš„config.yaml çš„socks5 ç«¯å£ä¸€è‡´ï¼ˆå¦‚æœclashæ²¡æœ‰å¼€å¯mixed_portï¼‰ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨ privoxy ç®¡ç†åå°é¡µé¢æŸ¥çœ‹å’Œç¼–è¾‘è‡ªå·±çš„ä»£ç†è§„åˆ™ã€‚
![privoxy-action](/assets/image/posts/2023-11-22-03.png?style=centerme)

æœ€åæœ€åï¼Œæˆ‘ä»¬è¦åœ¨ DSM ä¸­è®¾ç½®ä½¿ç”¨ä»£ç†ã€‚
![dsm-proxy](/assets/image/posts/2023-11-22-04.png?style=centerme)

## å¼€å¯ipv6å’ŒDDNS
å…³äºå¦‚ä½•å¼€å¯ ipv6 è¿™é‡Œä¸ç»†è¯´ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œæˆ‘é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯ï¼š**å…‰çŒ«æ¡¥æ¥æ¨¡å¼ + è·¯ç”±å™¨æ‹¨å·ä¸Šç½‘**ï¼Œè·¯ç”±å™¨æ˜¯ TP-LINK çš„ `TL-R470GP-AC`ï¼Œå®ƒæ˜¯ä¸€æ¬¾ `PoEÂ·AC` ä¸€ä½“æœºï¼Œè®¾ç½® ipv6 çš„æ•™ç¨‹å‚è€ƒå®˜æ–¹æ–‡æ¡£ [ä¼ä¸šè·¯ç”±å™¨IPv6ä¸Šç½‘é…ç½®æŒ‡å¯¼](https://smb.tp-link.com.cn/service/detail_article_4370.html)ï¼ŒæŒ‰ç…§æ­¥éª¤æ“ä½œæˆåŠŸå¼€é€šï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æµ‹è¯• ipv6 è¿æ¥æ—¶ï¼Œè¦é€€å‡ºæœ¬æœºè¿è¡Œçš„ä»£ç†è½¯ä»¶ï¼Œæˆ–è€…æŠŠä»£ç†çš„ ipv6 æ‰“å¼€ï¼ˆ*è¿™é‡Œæˆ‘è¢«å‘äº†å¾ˆä¹…*ï¼‰ã€‚

DDNS æˆ‘ä½¿ç”¨çš„æ˜¯ç¾¤æ™–å®˜æ–¹çš„æœåŠ¡ï¼Œå‚»ç“œæ“ä½œä¸æŠ˜è…¾äº†ï¼Œæœ€ç»ˆä¹Ÿèƒ½è¿æ¥æˆåŠŸï¼Œæœ€å¥½å¼€å¯ç¾¤æ™–çš„é˜²ç«å¢™ï¼Œåªæ”¾è¡Œå±€åŸŸç½‘è®¿é—®å’Œç‰¹å®šç«¯å£ã€‚

![ddns](/assets/image/posts/2023-11-22-05.png?style=centerme)

å¼ºè°ƒä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘ä¸Šé¢å¼€å¯äº†ä»£ç†æœåŠ¡å™¨ï¼ŒDDNS æ›´æ–°ä¹Ÿä¼šèµ°ä»£ç†ï¼Œä½†æ˜¯åªä»£ç†äº† ipv6ï¼Œæ‰€ä»¥ clash é‚£è¾¹çš„é…ç½®ä¹Ÿè¦æŠŠ ipv6 æ‰“å¼€ï¼Œæ‰“å¼€çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨ clash çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œ `ipv6: true` ï¼Œç„¶åé‡å¯ clash æœåŠ¡å³å¯ã€‚

## å…¶ä»–
dsm æ¯•ç«Ÿæ˜¯linuxç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥å®‰è£…å…¶ä»–çš„linuxå¸¸ç”¨å·¥å…·ã€‚

### å®‰è£… ncat
DSM ç³»ç»Ÿé»˜è®¤æ²¡æœ‰å®‰è£… nact å·¥å…·(telnetä¹Ÿæ²¡æœ‰å®‰è£…)ï¼Œå¯ä»¥è¿è¡Œ `sudo synogear install`ï¼Œç­‰å¾…ä¸‹è½½åè¿›å…¥ synogearï¼Œè¿è¡Œ `synogear list` åˆ—å‡ºå¯ç”¨çš„å·¥å…·åˆ—è¡¨ï¼Œé‡Œé¢å°±æœ‰ ncatã€‚ä¾‹å¦‚ï¼Œæ£€æŸ¥ privoxy æ˜¯å¦ç›‘å¬ 8118 ç«¯å£:
```bash
ncat 127.0.0.1 8118 -vz
```

### å®‰è£…opkgåŒ…ç®¡ç†å·¥å…·
åŒ…ç®¡ç†å·¥å…·æœ‰ `ipkg` å’Œ `opkg`ï¼Œä¸è¿‡å‰è€…å·²ç»åœæ­¢æ›´æ–°ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨åè€…ã€‚å®‰è£…æ­¥éª¤å‚è€ƒ[å®˜æ–¹ wiki â€” Synology NAS](https://github.com/Entware/Entware/wiki/Install-on-Synology-NAS)ã€‚

ä¸‹é¢åˆ—å‡ºä¸€äº›å¸¸ç”¨å‘½ä»¤ï¼š
```bash
sudo opkg list              #åˆ—å‡ºopkg å¯ç”¨çš„åŒ…
sudo opkg list-installed    #åˆ—å‡ºå·²å®‰è£…çš„åŒ…
sudo opkg install <pkg>     #å®‰è£…åŒ…
sudo opkg remove <pkg>      #å¸è½½åŒ…
sudo opkg find <pkg>        #æŸ¥æ‰¾åŒ…
```

### ä½¿ç”¨fdupesæ¥åˆ é™¤é‡å¤å›¾ç‰‡
ç¾¤æ™–æ— æ³•å®‰è£… `fdupes`ï¼Œä¸è¿‡åœ¨ github ä¸Šæ‰¾åˆ°ä¸€ä¸ª golang ç‰ˆæœ¬çš„ç‰ˆæœ¬ï¼Œæ­£å¥½ opkg èƒ½å®‰è£… golangï¼Œå¯ä»¥è‡ªå·± git æ‹‰ä¸‹æ¥æºç ç¼–è¯‘è¿è¡Œã€‚
```bash
# èƒ½æ‰¾åˆ° golang åŒ…ï¼Œè€Œä¸”ç‰ˆæœ¬è¿˜æ¯”è¾ƒæ–°
sudo opkg find go
go - 1.20.7-1 - Go is an open source programming language that makes it
 easy to build simple, reliable, and efficient software.

sudo opkg install go

# ä¸´æ—¶æŠŠ go åŠ å…¥ PATH
export PATH="$PATH:/opt/bin/go/bin"

# è®¾ç½®goproxy
go env -w GOPROXY=https://goproxy.cn,direct

# clone ä»£ç 
git clone https://github.com/OSPG/godedupe.git

# ç¼–è¯‘
cd godeedupe
go mod init godeedupe
go mod tidy
go build

# æŸ¥æ‰¾é‡å¤å›¾ç‰‡
./godeedupe  -t ~/Photos -m > dup.log

# åªç§»é™¤ PhotoLibrary æ–‡ä»¶å¤¹ä¸­é‡å¤çš„å›¾ç‰‡åˆ° dups æ–‡ä»¶å¤¹ä¸‹
mkdir dups
grep -w "PhotoLibrary" dup.log |grep -v "@eaDir" |xargs -I {} mv {} dups/

# æ£€æŸ¥ç…§ç‰‡æ— è¯¯ååˆ é™¤é‡å¤ç…§ç‰‡
rm -rf dups/
```

### Nginx åå‘ä»£ç† Gogs
ç¾¤æ™–ç³»ç»Ÿæœ¬èº«è‡ªå¸¦äº† nginx æœåŠ¡ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ docker çš„æ–¹å¼ã€‚é…ç½®æ­¥éª¤å¦‚ä¸‹ï¼š
```bash
# 1. åˆ›å»ºè‡ªå®šä¹‰nginx é…ç½®ç›®å½•
cd ~
mkdir -p nginx/conf.d
mkdir -p nginx/ssl

# 2. ä¸Šä¼ è¯ä¹¦å’Œç§é’¥æ–‡ä»¶åˆ° ssl

# 3. åˆ›å»º nginx é…ç½®
cd nginx/conf.d
vim dsm.conf

# 4. è¾“å…¥ä»¥ä¸‹å†…å®¹
server {
    #listen 8043 ssl;
    listen [::]:8043 ssl ipv6only=on;

    server_name xxx.synology.me;
    ssl_certificate /var/services/homes/xxx/nginx/ssl/cert.pem;
    ssl_certificate_key /var/services/homes/xxx/nginx/ssl/key.pem;

    location / {
        proxy_connect_timeout 60;
        proxy_read_timeout 60;
        proxy_send_timeout 60;
        proxy_intercept_errors off;
        proxy_http_version 1.1;
        proxy_set_header        Host                            $http_host;
        proxy_set_header        Upgrade                         $http_upgrade;
        proxy_set_header        Connection                      $connection_upgrade;
        proxy_set_header        X-Real-IP           $remote_addr;
        proxy_set_header        X-Forwarded-For         $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto       $scheme;

        proxy_pass http://127.0.0.1:3000;
    }

    # DS Photo é…ç½®ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯æœ¬åœ° 80 å’Œ 443 ç«¯å£ï¼Œæ­¤å¤„ä½¿ç”¨ 443 ç«¯å£ï¼Œå³ https
    #location /photo {
    #    proxy_pass https://ç¾¤æ™–å†…ç½‘åœ°å€;
    #}

    error_page 403 404 500 502 503 504 @error_page;
    # ä¸€ä¸ªå¥‡æŠ€æ·«å·§ğŸ¤£ï¼Œè®©httpå’Œhttpsç”¨åŒä¸€ä¸ªç«¯å£ï¼Œå‚è€ƒ https://www.zhihu.com/question/34017892
    error_page 497 https://$server_name:8043$request_uri;

    location @error_page {
        root /usr/syno/share/nginx;
        rewrite (.*) /error.html break;
        allow all;
    }
}

#server {
#    listen [::]:8030 ipv6only=on;
#    server_name bitcat.synology.me;
#    rewrite ^(.*) https://$server_name:8043$1 permanent;
#}

# 5. ä¿å­˜åé‡æ–°loadé…ç½®
sudo systemctl reload nginx.service
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢çš„ cert.pem è¯ä¹¦éœ€è¦æ·»åŠ ä¸Šä¸­é—´è¯ä¹¦ï¼Œåœ¨ç¾¤æ™–å¯¼å‡º `Let's Encrypt` è¯ä¹¦å‹ç¼©åŒ…ï¼Œé‡Œé¢å«æœ‰ä¸‰ä¸ªæ–‡ä»¶:
- ç§é’¥æ–‡ä»¶ï¼šprivate.pem
- è¯ä¹¦æ–‡ä»¶: cert.pem
- ä¸­é—´è¯ä¹¦ï¼šchain.pem

å¦‚æœåªä½¿ç”¨ cert.pemï¼Œåœ¨ git ä¸‹æ‹‰ä»£ç æ—¶ä¼šæŠ¥ä»¥ä¸‹é”™è¯¯ï¼š
```bash
SSL certificate problem: unable to get local issuer certificate
æˆ–è€…
SSL certificate problem: unable to verify the first certificate
```

è¿™å°±æ˜¯ç¼ºå°‘ä¸­é—´æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è¯¦ç»†çš„è¯ä¹¦ä¿¡æ¯ï¼š
```bash
 openssl s_client -showcerts -connect xxx.synology.me:8043
```

è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠ chain.pem çš„å†…å®¹å¤åˆ¶åè¿½åŠ åˆ° cert.pemï¼Œç„¶å reload nginx å³å¯ã€‚

### ä¿®æ”¹docketæ—¶åŒº
ç¾¤æ™–docker å®¹å™¨çš„é»˜è®¤æ—¶åŒºæ˜¯ UTCï¼Œå¯ä»¥é€šè¿‡å®¹å™¨çš„ç»ˆç«¯æœºâ¡ï¸æ–°å¢â¡ï¸bashï¼Œè¾“å…¥ `date` å‘½ä»¤æŸ¥çœ‹ã€‚

ä¿®æ”¹æ—¶åŒºæ­¥éª¤ï¼š
- ä½¿ç”¨ ssh ç™»å½• dsm;
- è¾“å…¥ `sudo docker ps` æŸ¥çœ‹å®¹å™¨åˆ—è¡¨;
- è¾“å…¥ `sudo docker cp /etc/localtime [æ—¶åŒºä¸å¯¹çš„å®¹å™¨id]:/etc/localtime` ä¿®æ”¹æ—¶åŒºæ–‡ä»¶;

æ­¤æ—¶ï¼Œå†æŸ¥çœ‹å®¹å™¨æ—¶é—´å°±æ­£å¸¸äº†ã€‚


## å‚è€ƒï¼š
- [linuxä¸‹éƒ¨ç½²Clash+dashboard](https://parrotsec-cn.org/t/linux-clash-dashboard/5169)
- [linux é…ç½® privoxy å®ç°ç³»ç»Ÿå…¨å±€/è‡ªåŠ¨ä»£ç†](https://blog.kelu.org/tech/2020/10/24/linux-privoxy.html)
- [ç†è§£socks5åè®®çš„å·¥ä½œè¿‡ç¨‹å’Œåè®®ç»†èŠ‚](https://wiyi.org/socks5-protocol-in-deep.html)
- [ç¾¤æ™–ä½¿ç”¨è‡ªæœ‰ Nginxè‡ªå®šä¹‰é…ç½®](https://lox.im/index.php/764.html)
- [nginx é…ç½®ä¸­é—´è¯ä¹¦](https://www.cnblogs.com/xuehuashanghe/p/14554856.html)